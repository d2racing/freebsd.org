#!/bin/sh
### ---- EDIT THESE VARIABLES ---- ###
NAS_IP="192.168.2.250"
SHARE_NAME="CS_Backup"
USERNAME="CS_Backup"
PASSWORD="TON_MOT_DE_PASSE"
MOUNT_POINT="/mnt/NAS"
######################################

echo "[*] Installing required packages..."
pkg install -y fusefs-smbnetfs samba416 iperf3

echo "[*] Loading FUSE kernel module..."
kldload fusefs

echo "[*] Enabling FUSE at boot..."
grep -q 'fusefs_load="YES"' /boot/loader.conf || \
    echo 'fusefs_load="YES"' | tee -a /boot/loader.conf

echo "[*] Creating ~/.nsmbrc..."
cat > ~/.nsmbrc <<EOF
[${NAS_IP}:${SHARE_NAME}]
password=${PASSWORD}
EOF

chmod 600 ~/.nsmbrc

echo "[*] Creating ~/.smbnetfs directory..."
mkdir -p ~/.smbnetfs

echo "[*] Creating ~/.smbnetfs/config..."
cat > ~/.smbnetfs/config <<EOF
[default]
username = ${USERNAME}
host = ${NAS_IP}
smb_version = 3
EOF

chmod 600 ~/.smbnetfs/config

echo "[*] Creating mount point ${MOUNT_POINT}..."
mkdir -p "$MOUNT_POINT"

echo "[*] Mounting SMBNetFS..."
smbnetfs "$MOUNT_POINT"

echo "[*] Listing share contents..."
ls "${MOUNT_POINT}/${NAS_IP}"

echo "[âœ“] Setup complete!"
